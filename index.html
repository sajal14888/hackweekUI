<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Compass</title>
    <style>
        /* Previous styles remain the same */
        
        /* Add new styles for suggest edits */
        .button-group-top {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .suggest-button {
            background-color: #8B5CF6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }

        .suggestion-panel {
            background-color: #F8FAFC;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .suggestion-header {
            font-size: 16px;
            font-weight: 500;
            color: #2C3E50;
            margin-bottom: 12px;
        }

        .suggestion-content {
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
        }

        .suggestion-section {
            font-size: 14px;
            color: #4B5563;
            margin-bottom: 8px;
        }

        .suggestion-text {
            font-size: 14px;
            line-height: 1.6;
            color: #2C3E50;
            background-color: #E8F5E9;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }

        .suggestion-explanation {
            font-size: 13px;
            color: #6B7280;
            font-style: italic;
            margin-top: 8px;
        }

        /* Previous styles continue... */
    </style>
</head>
<body>
    <div class="post-form-container">
        <h2>Content Compass</h2>
        <div>
            <label>Select the Content Database*</label>
            <select class="form-control" id="postType">
                <option value="square-help" selected>Square Help</option>
                <option value="squarewise">Google Drive</option>
                <option value="high-spot">High Spot</option>
            </select>
        </div>

        <div>
            <label>Search Your Topic</label>
            <input type="text" class="form-control" id="searchTopic" placeholder="">
            <div class="button-group-top">
                <button class="search-button" id="searchButton">Search</button>
                <button class="suggest-button" onclick="suggestEdits()">Suggest Edits</button>
            </div>
        </div>

        <div id="searchResults" class="search-results"></div>
    </div>

    <script>
        // Previous code remains the same until we add new functions

        function suggestEdits() {
            const searchQuery = document.getElementById('searchTopic').value.trim();
            const resultsDiv = document.getElementById('searchResults');

            if (!searchQuery) {
                resultsDiv.innerHTML = '<div class="error-message">Please enter a search term for suggestions</div>';
                return;
            }

            // Analyze query and find best matching section
            const bestMatch = findBestMatchingSection(searchQuery);
            if (!bestMatch) {
                resultsDiv.innerHTML = '<div class="error-message">Could not find a relevant section for suggestions</div>';
                return;
            }

            // Generate suggestion based on the query and section
            const suggestion = generateSuggestion(searchQuery, bestMatch);

            // Display suggestion
            resultsDiv.innerHTML = `
                <h3>Suggested Edit for "${bestMatch.title}"</h3>
                <div class="suggestion-panel">
                    <div class="suggestion-header">Based on your search: "${searchQuery}"</div>
                    <div class="suggestion-content">
                        <div class="suggestion-section">Recommended section to update:</div>
                        <div class="suggestion-text">${bestMatch.content}</div>
                        <div class="suggestion-section">Suggested addition:</div>
                        <div class="suggestion-text">${suggestion.content}</div>
                        <div class="suggestion-explanation">${suggestion.explanation}</div>
                    </div>
                </div>
            `;
        }

        function findBestMatchingSection(query) {
            const searchTerms = query.toLowerCase().split(' ');
            let bestMatch = null;
            let highestScore = 0;

            // Define section keywords mapping
            const sectionKeywords = {
                "Payment velocity": ["velocity", "frequency", "transactions", "repeat", "multiple"],
                "Address Verification System (AVS) Overview": ["avs", "address", "verification", "billing"],
                "Card Verification Value (CVV)": ["cvv", "verification", "security code"],
                "Payment amount": ["amount", "threshold", "limit", "transaction size"],
                "3D Secure (3DS)": ["3ds", "secure", "authentication", "verify"],
                "International payment cards": ["international", "country", "foreign"],
                "Prepaid payment cards": ["prepaid", "gift card", "non-traceable"],
                "Buyer IP address location": ["ip", "location", "country"],
                "View risk alerts": ["alert", "notification", "flag"]
            };

            // Score each section based on keyword matches
            squareHelpContent.articles.forEach(article => {
                let score = 0;
                const title = article.title.toLowerCase();
                const content = article.content.toLowerCase();

                // Check for direct keyword matches
                searchTerms.forEach(term => {
                    if (title.includes(term)) score += 2;
                    if (content.includes(term)) score += 1;
                });

                // Check for semantic relevance using section keywords
                Object.entries(sectionKeywords).forEach(([section, keywords]) => {
                    if (article.title.includes(section)) {
                        keywords.forEach(keyword => {
                            if (query.toLowerCase().includes(keyword.toLowerCase())) {
                                score += 3;
                            }
                        });
                    }
                });

                if (score > highestScore) {
                    highestScore = score;
                    bestMatch = article;
                }
            });

            return bestMatch;
        }

        function generateSuggestion(query, section) {
            const sectionType = section.title.toLowerCase();
            let suggestion = {
                content: '',
                explanation: ''
            };

            // Generate context-aware suggestions
            if (sectionType.includes('velocity')) {
                suggestion = {
                    content: `Consider implementing graduated velocity limits based on customer history:
- New customers: Maximum 3 transactions in 24 hours
- Established customers (30+ days): Maximum 5 transactions in 24 hours
- Premium customers (90+ days): Maximum 10 transactions in 24 hours
This approach balances fraud prevention with customer convenience.`,
                    explanation: 'This suggestion adds dynamic velocity limits based on customer history, which can help reduce false positives while maintaining security.'
                };
            } else if (sectionType.includes('avs')) {
                suggestion = {
                    content: `Implement a risk scoring system for AVS responses:
- Full match (both street and ZIP): Low risk - proceed
- ZIP match only: Medium risk - additional verification recommended
- No match: High risk - manual review required
- International transaction: Use alternative verification methods`,
                    explanation: 'This enhancement provides clear guidelines for handling different AVS response scenarios, improving fraud prevention effectiveness.'
                };
            } else if (sectionType.includes('cvv')) {
                suggestion = {
                    content: `Enhanced CVV verification protocol:
1. First attempt: Standard CVV check
2. Failed attempt: Prompt for re-entry with clear error message
3. Second failure: Trigger additional verification method
4. Third failure: Temporary block (15 minutes) to prevent brute force attempts`,
                    explanation: 'This structured approach helps prevent CVV guessing while providing clear customer feedback.'
                };
            } else if (sectionType.includes('3d secure')) {
                suggestion = {
                    content: `Optimize 3DS implementation:
1. Risk-based triggering: Apply 3DS selectively based on:
   - Transaction amount
   - Customer history
   - Device reputation
2. Fallback options for technical failures
3. Clear customer communication about the verification process`,
                    explanation: 'This suggestion helps balance security with user experience by applying 3DS strategically.'
                };
            } else {
                // Default suggestion for other sections
                suggestion = {
                    content: `Consider adding specific examples and clear guidelines for:
1. When to apply this security measure
2. How to handle exceptions
3. Best practices for your business type
4. Common scenarios and recommended actions`,
                    explanation: 'This structured approach helps make the documentation more actionable and practical.'
                };
            }

            return suggestion;
        }

        // Previous event listeners and code remain the same...
    </script>
</body>
</html>